<view class="detail-page">
  <scroll-view class="page-scroll" scroll-y="true" enhanced="true" show-scrollbar="{{false}}">

    <!-- Poster -->
    <view class="poster-wrapper llj-enter llj-delay-1">
      <view class="img-container">
        <swiper
          wx:if="{{imgList.length > 1}}"
          class="img-layer img-swiper"
          circular="true"
          indicator-dots
          indicator-color="rgba(255,255,255,0.45)"
          indicator-active-color="rgba(255,255,255,0.95)"
          autoplay
          interval="5000"
          duration="800"
        >
          <block wx:for="{{imgList}}" wx:key="*this">
            <swiper-item class="img-swiper-item">
              <image class="img-media" src="{{item}}" mode="aspectFill" />
            </swiper-item>
          </block>
        </swiper>

        <image
          wx:else
          class="img-layer img-media"
          src="{{imgList[0] || product.img}}"
          mode="aspectFill"
        />
      </view>
    </view>

    <!-- Content Flow -->
    <view class="content-flow">
      <view class="header-section llj-enter llj-delay-2">
        <view class="product-meta-row">
          <view class="title">{{product.name}}</view>
          <view class="price-block">
            <view class="price">
              <text class="currency">￥</text>
              <text>{{finalPrice || product.price}}</text>
            </view>
          </view>
        </view>
        <view class="desc" wx:if="{{product.desc}}">{{product.desc}}</view>
      </view>

      <view wx:if="{{product.hasSpecs}}" class="spec-section llj-enter llj-delay-3">
        <block wx:for="{{product.specs}}" wx:key="name">
          <view class="spec-group">
            <view class="section-title">{{item.name}}</view>
            <view class="spec-list">
              <block wx:for="{{item.options}}" wx:for-item="opt" wx:key="label">
                <view
                  class="spec-pill {{ specSelected[item.name] === opt.label ? 'active' : '' }}"
                  data-group="{{item.name}}"
                  data-option="{{opt.label}}"
                  bindtap="selectSpec"
                  hover-class="pill-hover"
                  hover-stay-time="80"
                >
                  {{opt.label}}
                </view>
              </block>
            </view>
          </view>
        </block>
      </view>

      <view class="qty-section llj-enter llj-delay-4">
        <view class="qty-label">数量</view>
        <view class="qty-wrapper">
          <view class="qty-btn minus" bindtap="decreaseQty" hover-class="qty-hover" hover-stay-time="80">
            <view class="icon-bar h"></view>
          </view>
          <view class="qty-num">{{quantity}}</view>
          <view class="qty-btn plus" bindtap="increaseQty" hover-class="qty-hover-dark" hover-stay-time="80">
            <view class="icon-bar h"></view>
            <view class="icon-bar v"></view>
          </view>
        </view>
      </view>

      <view class="detail-article llj-enter llj-delay-4">
        <view class="article-title">商品详情</view>
        <view class="article-text">{{product.detail || "暂无商品详情。"}}</view>
      </view>

      <view class="page-scroll-spacer"></view>
    </view>
  </scroll-view>

  <!-- Floating Action Bar -->
  <view class="float-bar-container llj-enter llj-delay-4">
    <view class="float-bar">
      <view class="total-info">
        <view class="total-label">合计</view>
        <view class="total-price">
          <text class="currency currency-sm">￥</text>
          <text>{{totalPrice}}</text>
        </view>
      </view>
      <button class="action-btn" bindtap="confirmAdd" hover-class="action-btn--hover" hover-stay-time="80">加入购物车</button>
    </view>
  </view>
</view>
