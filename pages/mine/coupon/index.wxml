<view class="page">
  <view class="tab-header">
    <view class="tab-item {{activeTab === 'available' ? 'active' : ''}}" data-tab="available" bindtap="switchTab">
      领券中心
    </view>
    <view class="tab-item {{activeTab === 'mine' ? 'active' : ''}}" data-tab="mine" bindtap="switchTab">
      我的优惠券
    </view>
  </view>

  <scroll-view class="page-scroll" scroll-y="true" enhanced="true" show-scrollbar="{{false}}" refresher-enabled="true" refresher-triggered="{{refresherTriggered}}" bindrefresherrefresh="onRefresherRefresh">
  <view class="content-body">
    
    <view class="coupon-list" wx:if="{{activeTab === 'available'}}">
      <block wx:if="{{availableCoupons.length > 0}}">
        <view class="coupon-ticket" wx:for="{{availableCoupons}}" wx:key="_id">
          <view class="ticket-left">
            <view class="price-row">
              <text class="symbol">￥</text>
              <text class="amount">{{item.discount}}</text>
            </view>
            <text class="condition">满{{item.minSpend}}元可用</text>
          </view>
          <view class="ticket-split">
            <view class="split-line"></view>
            <view class="circle-top"></view>
            <view class="circle-bottom"></view>
          </view>
          <view class="ticket-right">
            <view class="info">
              <view class="title">{{item.title}}</view>
              <view class="tags-row"><text class="tag">全场通用</text></view>
            </view>
            <view class="btn-claim {{claimingIds[item._id] ? 'disabled' : ''}}" data-id="{{item._id}}" bindtap="onClaim">
              {{claimingIds[item._id] ? '领取中' : '立即领取'}}
            </view>
          </view>
        </view>
      </block>
      <view class="empty-tip" wx:if="{{!loading && availableCoupons.length === 0}}">暂无可领取的优惠券</view>
    </view>

    <view class="coupon-list" wx:if="{{activeTab === 'mine'}}">
      <block wx:if="{{myCoupons.unused.length > 0}}">
        <view class="coupon-ticket" wx:for="{{myCoupons.unused}}" wx:key="groupKey">
          <view class="ticket-left">
            <view class="price-row">
              <text class="symbol">￥</text>
              <text class="amount">{{item.discount}}</text>
            </view>
            <text class="condition">满{{item.minSpend}}元可用</text>
          </view>
          <view class="ticket-split">
            <view class="split-line"></view>
            <view class="circle-top"></view>
            <view class="circle-bottom"></view>
          </view>
          <view class="ticket-right">
            <view class="info">
              <view class="title">{{item.title}}</view>
              <view class="tags-row">
                <text class="tag">长期有效</text>
                <text class="count-badge" wx:if="{{item.count > 1}}">x{{item.count}}张</text>
              </view>
            </view>
            <view class="btn-use" bindtap="goOrder">去使用</view>
          </view>
        </view>
      </block>
      <view class="empty-tip" wx:if="{{!loading && myCoupons.unused.length === 0}}">暂无未使用的优惠券</view>
    </view>

    <view class="loading-tip" wx:if="{{loading}}">加载中...</view>
  </view>
  </scroll-view>
</view>
