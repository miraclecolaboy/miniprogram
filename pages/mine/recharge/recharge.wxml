<view class="page">
  <scroll-view class="page-scroll" scroll-y="true" enhanced="true" show-scrollbar="{{false}}">
  <view class="header-section">
    <view class="asset-card">
      <view class="card-decoration">BALANCE</view>
      
      <view class="card-content">
        <view class="card-top">
          <view class="label-group">
            <view class="card-label-zh">当前余额</view>
            <view class="card-label-en">CURRENT BALANCE</view>
          </view>
          
          <view class="log-btn" bindtap="openLogPopup">
            <text>明细</text>
            <text class="arrow">›</text>
          </view>
        </view>
        
        <view class="balance-row">
          <text class="symbol">¥</text>
          <text class="balance-num">{{balanceText}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="section-wrap">
    <view class="section-header">
      <text class="section-title">充值金额</text>
      <view class="section-tag">极速到账</view>
    </view>
    
    <view class="grid-box">
      <view 
        class="option-btn {{amount === 100 ? 'active' : ''}}" 
        bindtap="selectAmount" 
        data-amount="{{100}}"
      >
        <text class="option-num">100</text>
      </view>

      <view 
        class="option-btn {{amount === 300 ? 'active' : ''}}" 
        bindtap="selectAmount" 
        data-amount="{{300}}"
      >
        <view class="badge">推荐</view>
        <text class="option-num">300</text>
      </view>

      <view 
        class="option-btn {{amount === 500 ? 'active' : ''}}" 
        bindtap="selectAmount" 
        data-amount="{{500}}"
      >
        <text class="option-num">500</text>
      </view>

      <view 
        class="option-btn {{amount === 1000 ? 'active' : ''}}" 
        bindtap="selectAmount" 
        data-amount="{{1000}}"
      >
        <text class="option-num">1000</text>
      </view>
    </view>

    <view class="custom-row {{!amount && customAmount ? 'active' : ''}}">
      <text class="custom-label">自定义金额</text>
      <view class="input-wrapper">
        <input
          class="custom-input"
          type="digit"
          placeholder="请输入" 
          placeholder-class="ph-style"
          bindinput="onCustomInput"
          bindfocus="onCustomFocus"
          value="{{customAmount}}"
        />
        <text class="custom-unit">元</text>
      </view>
    </view>
  </view>

  <view class="page-scroll-spacer"></view>
  </scroll-view>

  <view class="fixed-footer">
    <view class="footer-info">
      <text class="footer-label">充值金额</text>
      <view class="footer-total-row">
        <text class="footer-symbol">¥</text>
        <text class="footer-total">{{amount || customAmount || '0'}}</text>
      </view>
    </view>
    <view class="pay-btn" bindtap="onPay" hover-class="btn-hover">
      <text>立即充值</text>
    </view>
  </view>

  <view wx:if="{{showLogPopup}}" class="spec-mask" bindtap="closeLogPopup"></view>
  <view wx:if="{{showLogPopup}}" class="spec-popup" catchtap="noop">
    <view class="log-header">
      <view class="log-title">余额明细</view>
      <view class="log-tabs">
        <view class="log-tab {{logScene===''?'active':''}}" data-scene="" bindtap="changeLogScene">全部</view>
        <view class="log-tab {{logScene==='recharge'?'active':''}}" data-scene="recharge" bindtap="changeLogScene">充值</view>
        <view class="log-tab {{logScene==='order_pay'?'active':''}}" data-scene="order_pay" bindtap="changeLogScene">消费</view>
        <view class="log-tab {{logScene==='refund_balance'?'active':''}}" data-scene="refund_balance" bindtap="changeLogScene">退款</view>
      </view>
    </view>

    <scroll-view scroll-y="true" class="spec-scroll" enhanced="true" enable-flex="true" show-scrollbar="{{false}}">
      <block wx:if="{{logList.length}}">
        <block wx:for="{{logList}}" wx:key="_id">
          <view class="record-item">
            <view class="record-left">
              <view class="record-type">{{item.sceneText}}</view>
              <view class="record-time">{{item.timeText}}</view>
            </view>
            <view class="record-amount {{item.amount > 0 ? 'plus' : ''}}">
              {{item.amount > 0 ? '+' : ''}}{{item.amountText}}
            </view>
          </view>
        </block>
        <view style="height: 40rpx;"></view>
      </block>
      <view wx:else class="empty-state">暂无交易记录</view>
    </scroll-view>
  </view>
</view>
